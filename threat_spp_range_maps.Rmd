---
title: "Constrained threatened species ranges"
author: "Sara Williams"
date: "August 17, 2017"
output: pdf_document
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 500)
```
#  Threatened species ranges 

The following maps visualize species ranges and their overlap for three taxa in Sabah, Malaysia. 

All species from the orders Mammalia, Amphibia, and Aves of which any portion of their expected range fell within 
the state of Sabah, Malaysia were included. We desginated **threatened** to be any species listed under the 
*Critically Endangered*, *Endangered*, *Vulnerable*, or *Near Threatened*. We also included species labelled 
*Data Deficient* for this visualization.

Raw species range polygons for Mammalia and Amphibia were obtained from the IUCN Red List of Threatened Species, 
accessesed at the spatial data download repository [http://www.iucnredlist.org/technical-documents/spatial-data]. Raw 
species range polygons for Aves were obtained from the BirdLife International, the IUCN Red Listing Authority for birds. 
Raw species range polygons were processed and constrainted using upper and lower elevation limits for each species 
according to information found in the *species assessment* page under *Range Description* or *Additional Data*. 
Elevation data for Sabah, Malaysia were obtained from the Global Multi-resolution Terrain Elevation Data 2010
[https://lta.cr.usgs.gov/GMTED2010], which provide data at a 250m resolution. Future work will further constrain 
expected species ranges using water and forest dependencies.


#  Raster-based maps

The following 3 maps use raster values to indicate the number of constrained species ranges that have any portion 
fall over that raster cell. Warmer colors indicate more species and cooler colors indicate fewer species.

```{r echo = FALSE}
	plot_mams_r <- levelplot(mams_r, par.settings = r_theme, 
		main = "Threated mammal species ranges \n",
		xlab= "Longitude (UTM)",
		ylab="Latitude (UTM)", margin = FALSE) +
		layer(sp.polygons(border_sabah_d, lwd = 0.8, col = 'grey40')) + 
		layer(sp.polygons(border_sarawak_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) +
		layer(sp.polygons(border_kali_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) 
	plot_mams_r
```

```{r echo = FALSE}
	plot_amphs_r <- levelplot(amphs_r, par.settings = r_theme, 
		main = "Threated amphibian species ranges \n",
		xlab= "Longitude (UTM)",
		ylab="Latitude (UTM)", margin = FALSE) +
		layer(sp.polygons(border_sabah_d, lwd = 0.8, col = 'grey40')) + 
		layer(sp.polygons(border_sarawak_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) +
		layer(sp.polygons(border_kali_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) 
	plot_amphs_r
```

```{r echo = FALSE}
	plot_birds_r <- levelplot(birds_r, par.settings = r_theme, 
		main = "Threated bird species ranges \n",
		xlab= "Longitude (UTM)",
		ylab="Latitude (UTM)", margin = FALSE) +
		layer(sp.polygons(border_sabah_d, lwd = 0.8, col = 'grey40')) + 
		layer(sp.polygons(border_sarawak_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) +
		layer(sp.polygons(border_kali_d, lwd = 0.8, col = 'grey40', fill = 'gray40')) 
	plot_birds_r
```


#  Polygon-based maps

The following 3 maps use polygon shapefiles and with transparency (via the *alpha* parameter in **ggplot2**)
to show overlap of species ranges. More vibrant color indicates more species ranges in an area and weaker
color indicates fewer species ranges in an area.

```{r echo = FALSE}
	plot_mams_p <- ggplot(new_mams_sf_dat) +
		geom_sf(data = sabah_sf, colour = "grey90", fill = "grey80") +
		geom_sf(colour = "transparent", fill = "#972D15", alpha = 0.03) +
		geom_sf(data = sarawak_sf, colour = "grey70", fill = "grey70") +
		geom_sf(data = kali_sf, colour = "grey70", fill = "grey70") +
		coord_sf(crs = st_crs(32650)) +
		xlab("Latitude") +
		ylab("Longitude") +
		xlim(315000, 755000) +
		ylim(455000, 815000) +
		ggtitle("Threatened mammal species range overlap (97 species) ") +
	    theme_bw()
	plot_mams_p
```

```{r echo = FALSE}
	plot_amphs_p <- ggplot(new_amphs_sf_dat) +
		geom_sf(data = sabah_sf, colour = "grey90", fill = "grey80") +
		geom_sf(colour = "transparent", fill = "#972D15", alpha = 0.2) +
		geom_sf(data = sarawak_sf, colour = "grey70", fill = "grey70") +
		geom_sf(data = kali_sf, colour = "grey70", fill = "grey70") +
		coord_sf(crs = st_crs(32650)) +
		xlab("Latitude") +
		ylab("Longitude") +
		xlim(315000, 755000) +
		ylim(455000, 815000) +
		ggtitle("Threatened amphibian species range overlap (58 species)") +
		theme_bw()
	plot_amphs_p
```

```{r echo = FALSE}
	plot_birds_p <- ggplot(new_birds_sf_dat) +
		geom_sf(data = sabah_sf, colour = "grey90", fill = "grey80") +
		geom_sf(colour = "transparent", fill = "#972D15", alpha = 0.01) +
		geom_sf(data = sarawak_sf, colour = "grey70", fill = "grey70") +
		geom_sf(data = kali_sf, colour = "grey70", fill = "grey70") +
		coord_sf(crs = st_crs(32650)) +
		xlab("Latitude") +
		ylab("Longitude") +
		xlim(315000, 755000) +
		ylim(455000, 815000) +
		ggtitle("Threatened bird species range overlap (120 species)") +
		theme_bw()
plot_birds_p
```